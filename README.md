# expense-management

## 開発背景

もともと MoneyForward の有料プランで家計管理をしていたが、以下の不満があった。

* 連携が遅い(SBI証券が特に)
* Amazon や AmazonPay で買ったものが分からない
* 項目をフィルタしてカテゴリの一括変更ができなくて不便
  * カードを再連携したらカテゴリ分けのやり直しになる

そもそも、それらのサービスも各サイトにログインして明細を引っ張ってきているだけなのだから、自分でも作れるのでは？と思ったのがきっかけである。

## 設計や使い方

基本的には、各サイトから明細をダウンロードして本リポジトリの `data` 以下に配置して、コードを使って全体を集約するという機能にする。

また、以下のようなことができるようにする。

* Amazon 系の購入に関しては、カードの明細ではなく Amazon の購入履歴から詳細を取得する
  * つまり、カード側の Amazon 関係の行は無視する。

その他、明細 csv から取得する内容についての注意点を記しておく。

* Amazon の csv では、「注文合計」ではなく「商品小計」に着目し、一つ一つ何を買ったかが分かるように集計する
* Amazon ポイントは「注文合計」に対してかかってしまうので無視する（商品小計の金額のまま買ったとみなす）

## 明細ファイルのダウンロード方法

| 入力 | 明細確定日 | 明細ダウンロード方法 | 出力ファイル名 |
| --- | --- | --- | --- |
| Amazon | 翌月1日 | アマゾン注文履歴フィルタを有効化し、Amazonの注文履歴のフィルタの年と対象月を選択。デジタルとデジタル以外を選択し、予約分と0円は除外。領収書印刷用画面を開きcsvダウンロード | amazon-order_*_yyyy-m.csv |
| JRE Card | 翌月25日※ | Viewカードサイトからログインしてご利用明細照会からcsvダウンロード | ご利用明細_yyyymm.csv |
| SMBC | 翌月1日 | 三井住友銀行にログイン後、対象の口座を選択し、期間を１か月間に設定して明細ダウンロード | meisai.csv |
| SMBC Card | 翌月10日 | ログイン後、ご利用明細からcsvダウンロード | yyyymm.csv |

* ※ 翌月1日にはリストアップ済みのため、1日に確認可能。

## 明細ファイルの配置方法

`data` 以下の各フォルダに配置する。

## 全体の購買ログ作成方法

以下のコマンドを実行

```text
python csv2table.py
```

結果が `results` 以下に生成される。
